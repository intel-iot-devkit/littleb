find_package (Systemd REQUIRED)

add_definitions(${SYSTEMD_DEFINITIONS})

set (littleb_LIB_INCLUDE_DIRS
  ${PROJECT_SOURCE_DIR}/api
  ${PROJECT_SOURCE_DIR}/include
)

include_directories(
  ${littleb_LIB_INCLUDE_DIRS}
  ${SYSTEMD_INCLUDE_DIRS}
)

set (littleb_LIBS ${CMAKE_THREAD_LIBS_INIT} ${SYSTEMD_LIBRARIES})

set (littleb_LIB_SRCS
  ${CMAKE_CURRENT_SOURCE_DIR}/littleb.c
  ${CMAKE_CURRENT_SOURCE_DIR}/device.cpp
  ${CMAKE_CURRENT_SOURCE_DIR}/devicemanager.cpp
  ${CMAKE_CURRENT_SOURCE_DIR}/littlebtypes.cpp	
  # autogenerated version file
  ${CMAKE_CURRENT_BINARY_DIR}/version.c
)

set (littleb_LIB_GLOB_HEADERS
  ${PROJECT_SOURCE_DIR}/api/littleb.h
)

install (FILES ${littleb_LIB_GLOB_HEADERS} DESTINATION ${CMAKE_INSTALL_INCLUDEDIR})
#install (FILES ${PROJECT_SOURCE_DIR}/api/littleb.h DESTINATION ${CMAKE_INSTALL_INCLUDEDIR}/)

macro (littleb_CREATE_INSTALL_PKGCONFIG generated_file install_location)
  configure_file (${generated_file}.cmake ${CMAKE_CURRENT_BINARY_DIR}/${generated_file} @ONLY)
  install (FILES ${CMAKE_CURRENT_BINARY_DIR}/${generated_file} DESTINATION ${install_location})
endmacro (littleb_CREATE_INSTALL_PKGCONFIG)
littleb_create_install_pkgconfig (littleb.pc ${LIB_INSTALL_DIR}/pkgconfig)


add_library (littleb ${littleb_LIB_SRCS})
target_link_libraries (littleb ${littleb_LIBS})
set_target_properties(
   littleb
   PROPERTIES
   SOVERSION ${littleb_VERSION_MAJOR}
   VERSION ${littleb_VERSION_STRING}
)

install(TARGETS littleb DESTINATION ${LIB_INSTALL_DIR})
